<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="äºˆæƒ³å¤‰æ›">
    <link rel="manifest" href="./manifest.json">
    <title>ç«¶é¦¬äºˆæƒ³ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ  - å—é–¢ç«¶é¦¬åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-section, .output-section {
            width: 100%;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .output-area {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .convert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .copy-btn {
            background: #48bb78;
            color: white;
        }

        .copy-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(72, 187, 120, 0.4);
        }

        .clear-btn {
            background: #fc8181;
            color: white;
        }

        .clear-btn:hover {
            background: #f56565;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(252, 129, 129, 0.4);
        }

        .info-box {
            background: #e6f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #555;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .sample-btn {
            background: #ed8936;
            color: white;
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .sample-btn:hover {
            background: #dd6b20;
        }

        .clear-btn {
            flex: none;
            width: auto;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‡ ç«¶é¦¬äºˆæƒ³ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>å—é–¢ç«¶é¦¬ - äºˆæƒ³è¨˜å·ã‚’è‡ªå‹•æ•´ç†ãƒ»è²·ã„ç›®ç”Ÿæˆãƒ„ãƒ¼ãƒ«</p>
        </div>

        <div class="card">
            <div class="info-box">
                <h3>ğŸ“‹ ä½¿ã„æ–¹</h3>
                <ul>
                    <li>ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘</li>
                    <li>ã€Œå¤‰æ›å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>æ•´ç†ã•ã‚ŒãŸäºˆæƒ³ã¨è²·ã„ç›®ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</li>
                </ul>
            </div>

            <div class="input-section">
                <h2>ğŸ“¥ å…¥åŠ›ãƒ‡ãƒ¼ã‚¿</h2>
                <textarea id="inputData" placeholder="ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...

ä¾‹:
æ±äº¬1R
1 â–³ ã‚½ãƒ¼ã‚¯ãƒ¼ãƒ«
2 â–³ ã‚¹ãƒ”ãƒãƒ«ãƒ†ã‚½ãƒ¼ãƒ­
4 â–²â—â–²â–²â—‹ ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚¿ã‚­ã‚ªãƒ³
..."></textarea>
                <div class="button-group">
                    <button class="clear-btn" onclick="clearInput()">ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>

        <div class="card">
            <button class="convert-btn" onclick="convertData()">ğŸ”„ å¤‰æ›å®Ÿè¡Œ</button>
        </div>

        <div class="card">
            <div class="output-section">
                <h2>ğŸ“¤ å¤‰æ›çµæœ</h2>
                <div id="outputData" class="output-area">ã“ã“ã«å¤‰æ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</div>
                <div class="button-group">
                    <button class="copy-btn" onclick="copyOutput()">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¥åŠ›ã‚¯ãƒªã‚¢
        function clearInput() {
            document.getElementById('inputData').value = '';
            document.getElementById('outputData').textContent = 'ã“ã“ã«å¤‰æ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...';
        }

        // ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function convertData() {
            const input = document.getElementById('inputData').value.trim();
            if (!input) {
                alert('å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());

            // æœ€åˆã®è¡ŒãŒæ•°å­—ã§å§‹ã¾ã‚‹å ´åˆã¯ãƒ¬ãƒ¼ã‚¹ã‚¿ã‚¤ãƒˆãƒ«ãªã—
            const firstLineIsHorse = /^\d+[\s\t]/.test(lines[0]);
            const raceTitle = firstLineIsHorse ? '' : lines[0];
            const startIndex = firstLineIsHorse ? 0 : 1;
            let horses = [];

            // é¦¬ãƒ‡ãƒ¼ã‚¿ã®è§£æ
            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                // ã‚¿ãƒ–ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã«å¯¾å¿œ
                const match = line.match(/^(\d+)[\s\t]+(.*)$/);

                if (match) {
                    const number = match[1];
                    const rest = match[2].trim();

                    // ã‚¿ãƒ–ã¾ãŸã¯é€£ç¶šã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
                    const parts = rest.split(/[\s\t]+/).filter(p => p);

                    // æœ€å¾Œã®è¦ç´ ã‚’é¦¬åã¨ã™ã‚‹
                    const name = parts[parts.length - 1];

                    // ãã‚Œä»¥å¤–ã‚’è¨˜å·ã¨ã—ã¦çµåˆ
                    const symbols = parts.slice(0, -1).join('');

                    // è¨˜å·ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                    const counts = {
                        'â—': (symbols.match(/â—/g) || []).length,
                        'â—‹': (symbols.match(/â—‹/g) || []).length,
                        'â–²': (symbols.match(/â–²/g) || []).length,
                        'â–³': (symbols.match(/â–³/g) || []).length
                    };

                    // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ï¼ˆâ—=5, â—‹=4, â–²=3, â–³=2ï¼‰
                    const totalPoints = (counts['â—'] * 5) + (counts['â—‹'] * 4) + (counts['â–²'] * 3) + (counts['â–³'] * 2);

                    horses.push({
                        number,
                        name,
                        symbols,
                        counts,
                        priority: calculatePriority(counts),
                        totalPoints
                    });
                }
            }

            // 0ç‚¹ã®é¦¬ã‚’é™¤å¤–
            horses = horses.filter(h => h.totalPoints > 0);

            // ãƒã‚¤ãƒ³ãƒˆé †ã§ã‚½ãƒ¼ãƒˆ
            horses.sort((a, b) => b.totalPoints - a.totalPoints);

            // çµæœç”Ÿæˆ
            let output = raceTitle ? raceTitle + '\n' : '';

            // ãƒã‚¤ãƒ³ãƒˆé †ä½ã§è¨˜å·ã‚’å‰²ã‚Šå½“ã¦
            const classified = horses.map((h, index) => {
                if (h.totalPoints === 0) {
                    return { ...h, category: 'æŠ‘' };
                } else if (index === 0) {
                    return { ...h, category: 'â—' };
                } else if (index === 1) {
                    return { ...h, category: 'â—‹' };
                } else if (index >= 2 && index <= 3) {
                    return { ...h, category: 'â–²' };
                } else if (index >= 4 && index <= 5) {
                    return { ...h, category: 'â–³' };
                } else {
                    return { ...h, category: 'æŠ‘' };
                }
            });

            const honmei = classified.filter(h => h.category === 'â—');
            const taikou = classified.filter(h => h.category === 'â—‹');
            const tanaana = classified.filter(h => h.category === 'â–²');
            const renka = classified.filter(h => h.category === 'â–³');
            const osae = classified.filter(h => h.category === 'æŠ‘');

            // æœ¬å‘½
            honmei.forEach(h => {
                output += `â—${h.number}${h.name}\n`;
            });

            // å¯¾æŠ—
            taikou.forEach(h => {
                output += `â—‹${h.number}${h.name}\n`;
            });

            // å˜ç©´
            tanaana.forEach(h => {
                output += `â–²${h.number}${h.name}\n`;
            });

            // é€£ä¸‹
            renka.forEach(h => {
                output += `â–³${h.number}${h.name}\n`;
            });

            // æŠ‘ãˆ
            osae.forEach(h => {
                output += `æŠ‘${h.number}${h.name}\n`;
            });

            // è²·ã„ç›®ç”Ÿæˆ
            const mainHorses = [...honmei, ...taikou, ...tanaana].slice(0, 4);
            const subHorses = [...renka].slice(0, 2);
            const osaeHorses = [...osae].slice(0, 6);

            if (mainHorses.length >= 2) {
                output += '\nä¸‰é€£è¤‡è²·ã„ç›®\n';
                output += generateSanrenpuku(mainHorses, subHorses, osaeHorses);

                output += '\né¦¬å˜è²·ã„ç›®\n';
                output += generateUmatan(mainHorses, subHorses, osaeHorses);
            }

            document.getElementById('outputData').textContent = output;
        }

        // å„ªå…ˆåº¦è¨ˆç®—
        function calculatePriority(counts) {
            return (counts['â—'] * 1000) + (counts['â—‹'] * 100) + (counts['â–²'] * 10) + counts['â–³'];
        }

        // ä¸‰é€£è¤‡è²·ã„ç›®ç”Ÿæˆ
        function generateSanrenpuku(main, sub, osae) {
            let result = '';
            const mainNums = main.map(h => h.number);
            const subNums = sub.map(h => h.number);
            const osaeNums = osae.map(h => h.number);

            // è»¸é¦¬ï¼ˆä¸Šä½2é ­ï¼‰
            const axis = mainNums.slice(0, 2);
            // ç›¸æ‰‹é¦¬ï¼ˆæ®‹ã‚Šã®ãƒ¡ã‚¤ãƒ³ + é€£ä¸‹ï¼‰
            const mates = [...mainNums.slice(2), ...subNums];

            if (axis.length >= 1 && mates.length >= 1) {
                // å„è»¸é¦¬ã«ã¤ã„ã¦
                axis.forEach(ax => {
                    // è»¸é¦¬ä»¥å¤–ã®å…¨é¦¬ï¼ˆã‚‚ã†ä¸€æ–¹ã®è»¸é¦¬ + ç›¸æ‰‹é¦¬ï¼‰
                    const allMates = mainNums.filter(n => n !== ax).concat(subNums);

                    // è»¸é¦¬ã¨ç›¸æ‰‹é¦¬ã®å…¨çµ„ã¿åˆã‚ã›
                    allMates.forEach((mate, idx) => {
                        // 3ç€å€™è£œã‚’é †æ¬¡æ¸›ã‚‰ã™
                        const thirds = allMates.slice(idx + 1);
                        if (thirds.length > 0) {
                            result += `${ax}ï¼${mate}ï¼${thirds.join('ãƒ»')}\n`;
                        }
                    });
                });
            }

            if (osaeNums.length > 0) {
                result += `ï¼ˆ${osaeNums.join('.')}ï¼‰\n`;
            }

            return result;
        }

        // é¦¬å˜è²·ã„ç›®ç”Ÿæˆ
        function generateUmatan(main, sub, osae) {
            let result = '';
            const mainNums = main.map(h => h.number);
            const subNums = sub.map(h => h.number);
            const osaeNums = osae.map(h => h.number);

            const top2 = mainNums.slice(0, 2);

            top2.forEach(first => {
                // 1ç€è»¸é¦¬ä»¥å¤–ã®ãƒ¡ã‚¤ãƒ³é¦¬ã‚’ç›¸æ‰‹ã«
                const seconds = mainNums.filter(n => n !== first);
                result += `${first}ï¼${seconds.join('ãƒ»')}`;

                // é€£ä¸‹ + æŠ‘ãˆã‚’æ‹¬å¼§å†…ã«
                if (subNums.length > 0 || osaeNums.length > 0) {
                    const all = [...subNums, ...osaeNums];
                    result += `ï¼ˆ${all.join('.')}ï¼‰`;
                }
                result += '\n';
            });

            return result;
        }

        // çµæœã‚’ã‚³ãƒ”ãƒ¼
        function copyOutput() {
            const output = document.getElementById('outputData').textContent;
            if (output === 'ã“ã“ã«å¤‰æ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...') {
                alert('å¤‰æ›çµæœãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            navigator.clipboard.writeText(output).then(() => {
                alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }).catch(err => {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        }
        // Service Workerç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Workerç™»éŒ²æˆåŠŸ:', reg))
                    .catch(err => console.log('Service Workerç™»éŒ²å¤±æ•—:', err));
            });
        }
    </script>
</body>
</html>
